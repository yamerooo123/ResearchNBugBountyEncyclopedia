<# Made by Suphawith Phusanbai - The lazy pentester #>
Start-Sleep -Seconds 2

<# Check for PSBanner module #>
<# Use -ExpandProperty to extract string#>
$check_installed_module = Get-Module -Name PSBanner -ListAvailable | Select-Object -ExpandProperty Name
if ($check_installed_module -ne "PSBanner"){
    Install-Module -Name PSBanner -Scope CurrentUser -Force
}
else {
    Write-Host -Object "[+] You already have PSBanner module. Proceed to the next step." -ForegroundColor DarkGreen
}

Start-Sleep -Seconds 2

<# Import banner module. Use -Force param will get rid of terminal cache problem #>
powershell -c "Import-Module PSBanner -Force"

powershell -c "Write-Banner "DisStartUp""

Start-Sleep -Seconds 2

<# Simply print text #>
Write-Host -Object "[+] Checking for active startup programs..." -NoNewline -ForegroundColor DarkGreen

<# Sleep for 5 secs so you know what i am trying to do here #>
Start-Sleep -Seconds 2

<# List all startup programs #>
$StartupPrograms = Get-CimInstance Win32_StartupCommand | 
Select-Object Name, Command, Location

<# call first_output object to print out the output #>
$StartupPrograms | Format-Table -AutoSize

<# Ask for input #>
$ask_me = Read-Host -Prompt "[?] Do you want to disable any startup programs? A=All, N=No, E=enable all, 
and Y=Type the name" 

<# Logic for execution #>
if ($ask_me -ne "N" -and $ask_me -ne "A") {
    <# Shut down the specified program #>
    Write-Host  -Object '[!] Ok im checking. If there is any error you will see it in red highlighted text.' -ForegroundColor DarkGreen
    Start-Sleep -Seconds 2
    <# Default registry path #>
    $regKeyPaths = @(
        "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run",
        "HKLM:\Software\Microsoft\Windows\CurrentVersion\Run",
        "HKCU:\Software\Microsoft\Windows\CurrentVersion\RunOnce",
        "HKLM:\Software\Microsoft\Windows\CurrentVersion\RunOnce",
        "HKCU:\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run",
        "HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run",
        "HKLM:\Software\WOW6432Node\Microsoft\Windows\CurrentVersion\Run"
    )
    $regValueName = $ask_me
    Remove-ItemProperty -Path $regKeyPaths -Name $regValueName -Force
    foreach ($path in $regKeyPaths) {
        <# Test-Path = check if the paths in $StartupPaths are valid #>
        if (Test-Path $path) {
            Get-ItemProperty -Path $path | ForEach-Object {
                Remove-ItemProperty -Path $path -Name $_.Name -ErrorAction SilentlyContinue
            }
        }
    
    Start-Sleep -Seconds 2
    Write-Host -Object "[+] Checking the $ask_me process."
    Start-Sleep -Seconds 1
    Write-Host -Object "[+] The $ask_me is successfully deleted."
    Write-Host  -Object "[!] All done!" -ForegroundColor Green
    }

} elseif ($ask_me -eq "A") {
    <# Disable All #>
     Write-Host  -Object '[!] Ok im going to disable every startup programs'
    Start-Sleep -Seconds 2
    $StartupPaths = @(
        "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run",
        "HKLM:\Software\Microsoft\Windows\CurrentVersion\Run",
        "HKCU:\Software\Microsoft\Windows\CurrentVersion\RunOnce",
        "HKLM:\Software\Microsoft\Windows\CurrentVersion\RunOnce",
        "HKCU:\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run",
        "HKLM:\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\Run",
        "HKLM:\Software\WOW6432Node\Microsoft\Windows\CurrentVersion\Run"
    )
    Start-Sleep -Seconds 2
    Write-Host -Object "Finding all registry entry paths." 
    foreach ($path in $StartupPaths) {
        <# Test-Path = check if the paths in $StartupPaths are valid #>
        if (Test-Path $path -Erroraction SilentlyContinue ) {
            Get-ItemProperty -Path $path | ForEach-Object -Erroraction SilentlyContinue {
                Remove-ItemProperty -Path $path -Name $_.Name -ErrorAction SilentlyContinue
            }
        }
    }
    
    Start-Sleep -Seconds 2
    Write-Host -Object '[!] All done! Every startup programs is now disabled.' -ForegroundColor DarkGreen
}
else {
    <# if input = no then do nothing #>
    $execution = Write-Banner "Good  bye" -FontName "Segoe UI Emoji" -FontSize 10
    Write-Output $execution
}